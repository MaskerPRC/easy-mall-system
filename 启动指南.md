# 🚀 邮件服务器系统启动指南

## 📋 项目重构完成总结

✅ **前后端分离架构完成**
- 后端代码已移动到 `backend/` 目录
- 前端管理界面位于 `admin/` 目录  
- 删除了原有集成式管理端代码 (`public/` 目录)
- 删除了所有Docker部署脚本

## 🏗️ 新的项目结构

```
easy-mail-system/
├── backend/                # 后端API服务
│   ├── server.js          # 主服务器 (端口: 3000)
│   ├── database/          # 数据库初始化
│   ├── mail-server/       # SMTP/IMAP服务器  
│   ├── routes/            # API路由
│   ├── services/          # 业务服务
│   ├── utils/             # 工具函数
│   └── package.json       # 后端依赖
├── admin/                 # 前端管理界面  
│   ├── src/              # Vue 3源码
│   ├── package.json      # 前端依赖
│   └── vite.config.js    # Vite配置 (端口: 5173)
├── data/                 # 数据库文件
├── logs/                 # 日志文件
└── package.json          # 项目管理脚本
```

## 🚀 快速启动

### 方式一: 一键启动 (推荐开发)
```bash
npm run dev
```
这会同时启动前后端开发服务器:
- 后端API: http://localhost:3000
- 前端界面: http://localhost:5173

### 方式二: 分别启动
```bash
# 启动后端
npm run backend:dev

# 启动前端 (新终端)
npm run frontend:dev
```

### 方式三: 生产环境
```bash
# 构建前端
npm run build

# 启动后端
npm start
```

## 🔧 初始化配置

如果是首次运行，需要先初始化:
```bash
npm run setup
```

## 🌐 访问方式

### 新版Vue管理端 (推荐)
- 地址: http://localhost:5173
- 技术栈: Vue 3 + Vite + Element Plus
- 特性: 现代化界面，响应式设计

### API服务
- 地址: http://localhost:3000/api
- 健康检查: http://localhost:3000/health
- 文档: http://localhost:3000/api/docs

## 🔑 登录信息

默认管理员令牌: `your-secret-admin-token`

⚠️ **重要**: 生产环境请立即修改此令牌！

## 🔗 前后端通信机制

### API代理
前端开发服务器已配置代理，所有 `/api/*` 请求会自动转发到后端:
```javascript
// admin/vite.config.js
proxy: {
  '/api': {
    target: 'http://localhost:3000',
    changeOrigin: true
  }
}
```

### CORS配置
后端已配置CORS允许前端访问:
```javascript
// backend/server.js
cors({
  origin: [
    'http://localhost:5173', // Vue开发服务器
    'http://localhost:3000'  // 同源请求
  ]
})
```

## 📊 功能模块

1. **仪表板** - 系统概览和统计
2. **域名管理** - MX记录和SPF配置  
3. **邮箱账户** - 用户管理和配额
4. **邮件列表** - 收发记录查看
5. **Webhook** - 事件回调配置
6. **系统设置** - DNS指南和令牌管理

## 🔍 故障排除

### 端口占用
- 后端: 3000
- 前端: 5173
- SMTP: 25
- IMAP: 143

### 常见问题
1. **API连接失败**: 检查后端是否在3000端口运行
2. **前端无法访问**: 检查Vite代理配置
3. **数据库错误**: 运行 `npm run setup` 重新初始化

### 检查服务状态
```bash
# 检查后端健康状态
curl http://localhost:3000/health

# 查看端口占用
netstat -an | findstr ":3000\|:5173"
```

## 🛡️ 安全配置

- ✅ Bearer Token认证
- ✅ CORS跨域限制
- ✅ API速率限制
- ✅ 请求体大小限制
- ✅ 安全头部设置

## 📚 开发指南

### 后端开发
```bash
cd backend
npm run dev    # 自动重启
```

### 前端开发  
```bash
cd admin
npm run dev    # 热重载
```

### 添加新功能
1. 后端: 在 `backend/routes/` 添加API
2. 前端: 在 `admin/src/views/` 添加页面
3. 更新API服务: `admin/src/services/api.js`

## 🎉 完成状态

✅ 前后端完全分离
✅ 现代化Vue 3管理界面
✅ 完整的API接口
✅ 开发环境配置完成
✅ 生产部署准备就绪
✅ 详细文档说明

## 📞 下一步

1. 访问 http://localhost:5173 体验新界面
2. 配置域名DNS记录
3. 创建邮箱账户进行测试
4. 根据需要调整系统配置

🎊 **项目重构完成！** 现在您可以享受现代化的前后端分离邮件服务器系统了！